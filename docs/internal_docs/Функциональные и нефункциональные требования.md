# Meet2Obsidian: Требования к системе

## Обзор продукта

Meet2Obsidian - это утилита командной строки для macOS, предназначенная для автоматической обработки видеозаписей встреч, их транскрибации и создания структурированных заметок в Obsidian. Система работает в фоновом режиме, не требует постоянного взаимодействия с пользователем и интегрируется с API-сервисами для транскрибации и анализа контента.

## 1. Функциональные требования

### 1.1 Основные возможности

#### 1.1.1 Мониторинг файлов
- Система ДОЛЖНА отслеживать указанную директорию на наличие новых MP4-файлов
- Система ДОЛЖНА корректно обрабатывать файлы, добавляемые во время ее работы
- Система ДОЛЖНА игнорировать уже обработанные файлы
- Система ДОЛЖНА распознавать случаи частичной загрузки файла и ожидать полного копирования перед обработкой

#### 1.1.2 Обработка видео
- Система ДОЛЖНА извлекать аудиодорожку из MP4-файлов в формат M4A
- Система ДОЛЖНА сохранять извлеченные аудиофайлы с оригинальными именами (без расширения)
- Система ДОЛЖНА удалять исходные видеофайлы после успешного извлечения аудио
- Система ДОЛЖНА обрабатывать файлы последовательно, не перегружая систему

#### 1.1.3 Транскрибация
- Система ДОЛЖНА отправлять аудиофайлы в сервис Rev.ai через API
- Система ДОЛЖНА отслеживать статус задач транскрибации
- Система ДОЛЖНА загружать результаты транскрибации после завершения задачи
- Система ДОЛЖНА обрабатывать ошибки API и реализовывать механизм повторных попыток
- Система ДОЛЖНА работать с аудиофайлами различной длительности (до 8 часов)

#### 1.1.4 Анализ контента
- Система ДОЛЖНА использовать API Claude для анализа транскрипции
- Система ДОЛЖНА извлекать следующую информацию из транскрипции:
  - Общие сведения о встрече
  - Краткое содержание
  - Достигнутые договоренности
  - Поставленные задачи
- Система ДОЛЖНА использовать настраиваемые промпты для взаимодействия с API Claude
- Система ДОЛЖНА обрабатывать длинные транскрипции, разбивая их на части при необходимости

#### 1.1.5 Создание заметок
- Система ДОЛЖНА создавать директорию "Meeting Records" в указанном Obsidian vault
- Система ДОЛЖНА генерировать заметки в формате Markdown
- Система ДОЛЖНА структурировать заметки по разделам:
  - Сведения о встрече
  - Краткое содержание встречи
  - Договоренности встречи
  - Задачи, поставленные в ходе встречи
  - Стенограмма встречи
- Система ДОЛЖНА использовать метаданные заметок (frontmatter) для совместимости с Obsidian

#### 1.1.6 Очистка и управление файлами
- Система ДОЛЖНА удалять аудиофайлы после завершения обработки (опционально, настраивается)
- Система ДОЛЖНА обеспечивать корректную обработку файловых операций с проверкой прав доступа

### 1.2 Конфигурация и управление

#### 1.2.1 Начальная настройка
- Система ДОЛЖНА запрашивать необходимые настройки при первом запуске
- Система ДОЛЖНА сохранять конфигурацию в защищенном файле
- Система ДОЛЖНА проверять действительность API-ключей при настройке

#### 1.2.2 Командная строка
- Система ДОЛЖНА поддерживать следующие команды:
  - `start`: запуск сервиса в фоновом режиме
  - `stop`: остановка сервиса
  - `status`: вывод текущего состояния и статистики
  - `logs`: вывод последних важных записей из логов
  - `config`: настройка параметров
  - `test`: проверка доступности API и прав доступа к файлам
  - `help`: справка по командам

#### 1.2.3 Настраиваемые параметры
- Система ДОЛЖНА позволять настраивать следующие параметры:
  - Путь к директории с видеозаписями встреч
  - Путь к Obsidian vault
  - API-ключ Rev.ai
  - API-ключ Claude
  - Автозапуск при старте системы (вкл/выкл)
  - Удаление исходных файлов (вкл/выкл)
  - Удаление аудиофайлов после обработки (вкл/выкл)
  - Пути к файлам шаблонов промптов
  - Уровень подробности логирования

#### 1.2.4 Автозапуск
- Система ДОЛЖНА интегрироваться с macOS LaunchAgents для автозапуска
- Система ДОЛЖНА предоставлять команды для включения/отключения автозапуска
- Система ДОЛЖНА корректно обрабатывать сигналы завершения от системы

### 1.3 Мониторинг и логирование

#### 1.3.1 Логирование
- Система ДОЛЖНА вести детальные логи с разделением по уровням важности
- Система ДОЛЖНА сохранять логи в ротируемые файлы
- Система ДОЛЖНА включать в логи временные метки и контекстную информацию
- Система ДОЛЖНА логировать статус каждого этапа обработки файлов

#### 1.3.2 Мониторинг состояния
- Система ДОЛЖНА отслеживать статус каждого файла в процессе обработки
- Система ДОЛЖНА предоставлять команду для просмотра текущего статуса и статистики
- Система ДОЛЖНА отслеживать статус API-сервисов и уведомлять о проблемах

#### 1.3.3 Уведомления
- Система ДОЛЖНА обеспечивать опциональные уведомления об ошибках через macOS Notification Center
- Система ДОЛЖНА иметь возможность отправлять критические уведомления
- Система ДОЛЖНА группировать уведомления, чтобы не перегружать пользователя

## 2. Нефункциональные требования

### 2.1 Производительность и ресурсы

#### 2.1.1 Использование ресурсов
- Система ДОЛЖНА минимизировать использование ЦП при работе в фоновом режиме (%3C5% в режиме ожидания)
- Система ДОЛЖНА ограничивать использование памяти (не более 200MB в режиме ожидания)
- Система ДОЛЖНА обеспечивать последовательную, а не параллельную обработку файлов для оптимизации ресурсов

#### 2.1.2 Масштабируемость
- Система ДОЛЖНА корректно обрабатывать очереди файлов (до 50 файлов)
- Система ДОЛЖНА обрабатывать файлы большого размера (до 10GB)
- Система ДОЛЖНА работать с транскрипциями большой длины (до 200,000 слов)

#### 2.1.3 Время отклика
- Система ДОЛЖНА начинать обработку нового файла в течение 60 секунд после его появления
- Система ДОЛЖНА реагировать на команды пользователя в течение 2 секунд

### 2.2 Надежность и стабильность

#### 2.2.1 Устойчивость к сбоям
- Система ДОЛЖНА автоматически восстанавливаться после сбоев
- Система ДОЛЖНА сохранять статус обработки файлов для возобновления после перезапуска
- Система ДОЛЖНА обрабатывать ситуации с недоступностью API-сервисов
- Система ДОЛЖНА корректно работать при ограниченном доступе к интернету с автоматическим возобновлением задач

#### 2.2.2 Долговременная стабильность
- Система ДОЛЖНА стабильно работать без перезапуска минимум 30 дней
- Система ДОЛЖНА контролировать использование памяти для предотвращения утечек
- Система ДОЛЖНА иметь механизм самодиагностики и предупреждения о потенциальных проблемах

#### 2.2.3 Обработка ошибок
- Система ДОЛЖНА обрабатывать все исключения без аварийного завершения
- Система ДОЛЖНА реализовывать механизм повторных попыток с экспоненциальной задержкой
- Система ДОЛЖНА классифицировать ошибки по типам (временные/постоянные) для корректной обработки

### 2.3 Безопасность

#### 2.3.1 Защита данных
- Система ДОЛЖНА хранить API-ключи в зашифрованном виде с использованием macOS Keychain
- Система ДОЛЖНА применять безопасные практики передачи данных при взаимодействии с API
- Система ДОЛЖНА обеспечивать возможность отзыва и обновления API-ключей

#### 2.3.2 Приватность
- Система ДОЛЖНА минимизировать хранение промежуточных данных
- Система ДОЛЖНА удалять временные файлы после обработки
- Система НЕ ДОЛЖНА отправлять данные третьим сторонам, кроме указанных API-сервисов

#### 2.3.3 Доступ и права
- Система ДОЛЖНА работать с минимально необходимыми правами
- Система ДОЛЖНА проверять и запрашивать необходимые разрешения для доступа к файлам

### 2.4 Поддержка и сопровождение

#### 2.4.1 Установка и обновления
- Система ДОЛЖНА иметь простой процесс установки (через Homebrew или скрипт)
- Система ДОЛЖНА проверять наличие обновлений
- Система ДОЛЖНА поддерживать обновление без потери настроек

#### 2.4.2 Документация
- Система ДОЛЖНА иметь документацию в виде man-страниц
- Система ДОЛЖНА предоставлять подробную справку через команду `help`
- Система ДОЛЖНА документировать все возможные ошибки и способы их решения

#### 2.4.3 Диагностика
- Система ДОЛЖНА включать режим диагностики для выявления проблем
- Система ДОЛЖНА генерировать отчет о состоянии системы по запросу
- Система ДОЛЖНА включать инструменты самопроверки

### 2.5 Совместимость

#### 2.5.1 Операционная система
- Система ДОЛЖНА работать на macOS 11 (Big Sur) и выше
- Система ДОЛЖНА поддерживать как Intel, так и Apple Silicon процессоры
- Система ДОЛЖНА учитывать особенности безопасности современных версий macOS

#### 2.5.2 Зависимости
- Система ДОЛЖНА минимизировать внешние зависимости
- Система ДОЛЖНА проверять наличие необходимых зависимостей при установке
- Система ДОЛЖНА уметь работать в изолированном окружении (venv)

#### 2.5.3 Интеграции
- Система ДОЛЖНА интегрироваться с текущими версиями API Rev.ai и Claude
- Система ДОЛЖНА быть совместима с текущими структурами Obsidian vault
- Система ДОЛЖНА адаптироваться к изменениям в API путем обновления конфигурации

## 3. Ограничения и предположения

### 3.1 Ограничения
- Система работает только на платформе macOS
- Система требует доступа к интернету для взаимодействия с API
- Система требует наличия действующих API-ключей для Rev.ai и Claude
- Система рассчитана на работу с видеофайлами в формате MP4
- Система не имеет графического интерфейса

### 3.2 Предположения
- Пользователь имеет базовые навыки работы с командной строкой
- Obsidian установлен и настроен на компьютере пользователя
- Пользователь имеет права на создание и изменение файлов в указанных директориях
- Формат имени файла видеозаписи содержит информацию о дате и времени встречи

## 4. Дополнительные функции для будущих версий

### 4.1 Возможные улучшения
- Распознавание участников встречи по голосу
- Интеграция с календарем для добавления метаданных о встрече
- Базовый веб-интерфейс для мониторинга и конфигурации
- Расширенный анализ контента с выделением ключевых тем и концепций
- Кросс-платформенная поддержка (Windows, Linux)
- Интеграция с другими сервисами заметок, помимо Obsidian
- Создание автоматических связей с существующими заметками по релевантности

## 5. Метрики качества продукта

### 5.1 Критерии приемки
- Успешная обработка 95% тестовых видеофайлов
- Время отклика на команды менее 2 секунд
- Использование CPU в фоновом режиме менее 5%
- Использование памяти в фоновом режиме менее 200MB
- Восстановление после всех искусственно вызванных сбоев
- Корректная работа всех команд CLI
- Соответствие всех генерируемых заметок шаблону
- Успешное прохождение всех тестов безопасности

### 5.2 Ожидаемая нагрузка
- До 10 новых видеофайлов в день
- Средний размер файла: 100-500MB
- Средняя продолжительность видео: 30-60 минут
- Пиковая нагрузка: до 5 файлов одновременно

## Приложения

### А. Глоссарий
- **MP4**: формат видеофайла
- **M4A**: формат аудиофайла
- **API**: интерфейс программирования приложений
- **Rev.ai**: сервис для транскрибации аудио в текст
- **Claude**: сервис ИИ для анализа текста от Anthropic
- **Obsidian**: приложение для создания и управления заметками
- **Vault**: хранилище заметок в Obsidian
- **Markdown**: язык разметки, используемый в Obsidian
- **LaunchAgent**: механизм автозапуска в macOS

### Б. Примеры команд CLI
```
meet2obsidian start                 # Запуск сервиса
meet2obsidian stop                  # Остановка сервиса
meet2obsidian status                # Вывод текущего статуса
meet2obsidian logs                  # Просмотр последних логов
meet2obsidian config show           # Просмотр текущей конфигурации
meet2obsidian config set KEY VALUE  # Изменение параметра конфигурации
meet2obsidian test                  # Проверка системы
meet2obsidian help                  # Справка по командам
```

### В. Структура конфигурационного файла
```yaml
paths:
  video_directory: "/Users/username/Documents/meet_records"
  obsidian_vault: "/Users/username/Documents/Obsidian/MainVault"
  log_directory: "/Users/username/Library/Logs/meet2obsidian"

api:
  rev_ai:
    # API ключи хранятся в Keychain, не в config файле
    job_timeout: 3600  # секунды
    max_retries: 3
  claude:
    model: "claude-3-opus-20240229"
    temperature: 0.1
    max_tokens: 1000

processing:
  delete_video_files: true
  delete_audio_files: true
  process_interval: 60  # секунды
  file_completed_action: "none"  # none, move, archive

templates:
  prompts_directory: "/Users/username/.config/meet2obsidian/prompts"
  note_template: "default.md.j2"

system:
  autostart: true
  loglevel: "info"  # debug, info, warning, error
  notifications: true
  max_concurrent_jobs: 1
```